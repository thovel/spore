#!/bin/bash

# Iterates over a policy until it stabilizes
policy=$1
if [ -z "$policy" ] ; then
  echo "Please specify a directory containing users and so on."
  exit 2
do
if [ ! -d "$policy" ] ; then
  echo "Policy needs to be a directory."
  exit 2
do

max_policies=1000
counter=0
outstanding_policies_bin=$(dirname $0)/outstanding-policies
oldscript="something"
while [[ $counter -lt $max_policies ]]
do
  script="$("$outstanding_policies_bin" "$policy")"
  if [ -z "$script" ] ; then
    break;
  fi
  if [ "${oldscript}" == "${script}" ] ; then
    break;
  fi
  eval "${script}"
  oldscript="${script}"
  counter=$((counter + 1))
done
echo "${script}"
echo "Complete ($counter commands run)."

