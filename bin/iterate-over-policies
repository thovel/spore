#!/bin/bash

# Iterates over a policy until it stabilizes
policy=$1
max_policies=100
counter=0
outstanding_policies_bin=$(dirname $0)/outstanding-policies
oldscript="something"
while [[ $counter -lt $max_policies ]]
do
  script="$("$outstanding_policies_bin" "$policy")"
  if [ -z "$script" ] ; then
    break;
  fi
  if [ "${oldscript}" == "${script}" ] ; then
    break;
  fi
  eval "${script}"
  oldscript="${script}"
  counter=$((counter + 1))
done
echo "${script}"
echo "Complete ($counter commands run)."

